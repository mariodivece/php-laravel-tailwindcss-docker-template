# Development Dockerfile for PHP Laravel + React + TailwindCSS
# This provides hot reloading for development
# Uses the same base image as production to ensure consistency
FROM laravel-react-base

# Copy the application code
COPY . .

# Ensure necessary directories exist with proper permissions
RUN mkdir -p /var/www/html/storage/logs \
    /var/www/html/storage/framework/cache \
    /var/www/html/storage/framework/sessions \
    /var/www/html/storage/framework/views \
    /var/www/html/bootstrap/cache \
    /var/www/html/database

# Install PHP dependencies (dev dependencies included for development)
RUN composer install --optimize-autoloader

# Install Node dependencies
RUN npm install

# Set proper permissions for copied files
RUN chown -R www-data:www-data /var/www/html/storage \
    && chown -R www-data:www-data /var/www/html/bootstrap/cache \
    && chown -R www-data:www-data /var/www/html/database \
    && chmod -R 755 /var/www/html/storage \
    && chmod -R 755 /var/www/html/bootstrap/cache

# Copy nginx configuration
COPY docker/nginx.conf /etc/nginx/sites-available/default

# Copy development startup script and supervisor configuration
COPY docker/start-dev.sh /start-dev.sh
COPY docker/dev-services.conf /etc/supervisor/conf.d/dev-services.conf

# Make the startup script executable
RUN chmod +x /start-dev.sh

# Expose ports
EXPOSE 80 5173

# Start development environment
CMD ["/start-dev.sh"]

# Note: hot file will be created by vite during development and should be removed before production builds
